
# libgeomag

This repository contains NGDC [geomag](https://www.ngdc.noaa.gov/IAGA/vmod/geomag70_license.html) source code that has been modified to allow it to be used as a library for inclusion in larger projects.

# Building

Build with

    $ make

By default, this will build the static library (libgeomag.a) and a test
utility called test_geomag(.exe). (Building test_geomag requires that NetCDF
be installed.)

# Testing

To run the test, you will need to download the geomag program from the [NGDC's website](https://www.ngdc.noaa.gov/IAGA/vmod/igrf.html) and extract `IGRF12.COF`. Place said file in the same directory as `test_geomag`. Run the test with

    $ ./test_geomag

or

	$ ./test_geomag.exe

on Windows. This generates the file `test.nc` containing a uniform sampling of the Earth's magnetic field at a fixed height covering the globe. You can use the [NetCDF operators (nco)](http://nco.sourceforge.net/) to verify that the output generated by `test_geomag` is the same as what `geomag70.exe` (the program provided by NGDC) would generate by running

	$ python geomag2nc.py

which generates a file `out.nc`. (You will need to place `geomag70.exe` in the same directory as `geomag2nc.py`.) Then, take the difference of the two files with

    $ ncbo --op_typ=- out.nc test.nc diff.nc

The output of ncbo may then be inspected visually with ncdump:

    $ ncdump diff.nc

You should find that the contents of the file are very close to zero. (The reason for the error is actually because of truncation of digits in geomag70.exe output, not because of a difference in this code from the original sources.)
